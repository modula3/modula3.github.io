<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
  <head>
    <title>CM3 Installation Notes</title>
    <META HTTP-EQUIV="Content-Type" CONTENT="text/html">
    <META HTTP-EQUIV="Content-Style-Type" CONTENT="text/css">
    <META HTTP-EQUIV="Resource-type" CONTENT="document"> 
    <META HTTP-EQUIV="Reply-to" CONTENT="m3-support@elego.de"> 
    <LINK HREF="normal.css" REL="stylesheet" TYPE="text/css">
    <META NAME="robots" content="noindex">
  </head>

  <body bgcolor="#ffffff">

  <h1>CM3 5.5.1 Installation on Ubuntu 7.10 and Similar GNU/Linux Distributions</h1>
<p>(actually tested on an UbuntuStudio 7.10)</p>

<p>(c) 2008 by Elego Software Solutions GmbH</p>

<p>This document is published under the same license as cm3 (Critical Mass Modula3), which basically means that it is free to change and/or distribute under certain conditions, and that there is NO WARRANTY OR RELIABILITY of any kind. Refer to CM3's license information for further details.</p>

<p>Last update: 2008-January-25</p>
<p>Authors: Neels Janosch Hofmeyr, neels@elego.de</p>

<p>This document is based on these installation notes:</p>

<pre> http://modula3.elegosoft.com/cm3/installation.html</pre>

<p>However, this document gives more specific information that applies to Ubuntu 7.10 and possibly other Ubuntus and GNU/Linux distributions. Here we go...</p>


<p>=========================================================================</p>


<p>Prerequisites:</p>

<p>Be sure to have these packages installed:</p>
<pre>  gcc (the GNU compiler collection)</pre>
<pre>  binutils (for ar and as)</pre>
<pre>  flex (for libfl.a)</pre>

<p>Furthermore, cminstall will look for the following packages/libraries, which are only necessary if you want to develop applications that use these libraries; if unsure, just install these and ignore errors as described below:</p>
<pre>  libpq5-dev (for libpq.so)</pre>
<pre>  freeglut3-dev (for libGL.so, libGLU.so)</pre>
<pre>  unixodbc-dev (for libodbc.so)</pre>
<pre>  libmotif-dev (for libXm.so)</pre>
<pre>  libx11-dev (for a series of libX*.so files)</pre>

<p>Also, in order for cminstall (below) to find some of the X11 libraries, you have to create symbolic links:</p>
<pre>  sudo -s</pre>
<pre>  cd /usr/lib</pre>
<pre>  ln -s libXmu.so.6 libXmu.so</pre>
<pre>  ln -s libXaw.so.7 libXaw.so</pre>

<p>(If any other library file is not found, try to locate it using packages.ubuntu.com and install the appropriate package or add symbolic links to account for slight name differences as above)</p>


<p>=========================================================================</p>


<p>First, let's do the minimal binary installation.</p>

<p>Download this package to your Desktop:</p>

<pre>  http://modula3.elegosoft.com/cm3/snaps/cm3-min-POSIX-LINUXLIBC6-d5.5.1-2008-01-24-03-35-01.tgz</pre>

<p>Note that most other minimal binaries do NOT work, so stick with d5.5.1 or later.</p>
<p>(This snapshot is known to succeed on Ubuntu 7.10. Newer snapshots may also work. Link obtained from</p>
<pre>  http://modula3.elegosoft.com/cm3/snaps/snapshot-index.html</pre>
<p>)</p>


<p>You will find the appropriate checksum on</p>
<pre>  http://modula3.elegosoft.com/cm3/checksums.php3</pre>
<p>or just use the commands from this screenshot:</p>
<p>"</p>
<p>$ md5sum cm3-min-POSIX-LINUXLIBC6-d5.5.1-2008-01-24-03-35-01.tgz</p>
<p>b3235f920e35f7b2f472d12c5bd8478d  cm3-min-POSIX-LINUXLIBC6-d5.5.1-2008-01-24-03-35-01.tgz</p>

<p>$ wget -q -O - http://modula3.elegosoft.com/cm3/checksums.php3 | grep cm3-min-POSIX-LINUXLIBC6-d5.5.1-2008-01-24-03-35-01.tgz</p>
<p>-rw-r--r-- 1 wagner   wagner  7034105 2008-01-24 04:55 snaps/cm3-min-POSIX-LINUXLIBC6-d5.5.1-2008-01-24-03-35-01.tgz</p>
<p>lrwxrwxrwx 1 m3       m3           55 2008-01-25 01:05 snaps/cm3-min-POSIX-LINUXLIBC6.tgz -> cm3-min-POSIX-LINUXLIBC6-d5.5.1-2008-01-24-03-35-01.tgz</p>
<p>1801216045 7034105 snaps/cm3-min-POSIX-LINUXLIBC6-d5.5.1-2008-01-24-03-35-01.tgz</p>
<p>b3235f920e35f7b2f472d12c5bd8478d  snaps/cm3-min-POSIX-LINUXLIBC6-d5.5.1-2008-01-24-03-35-01.tgz</p>
<p>"</p>


<p>By the way, if you have given your user write permission to /usr/local/cm3, you do not need any of the "sudo"s below (e.g. instead of "sudo ./cminstall", just run "./cminstall", and skip all the "sudo -s" lines). It is good practice to do as much as possible as an unprivileged user.</p>


<p>Run these commands:</p>

<pre>  mkdir ~/cm3-min</pre>
<pre>  cd ~/cm3-min</pre>
<pre>  tar xzf ~/Desktop/cm3-min-POSIX-LINUXLIBC6-d5.5.1-2008-01-24-03-35-01.tgz</pre>
<pre>  sudo ./cminstall</pre>

<p>Ideally, cminstall will just succeed. If it asks any questions, that's because it could not find some library. Below are the would-be correct answers.</p>
<p>Note that, if one of the libraries is not installed and if you furthermore choose to skip that library, you can answer the questions like shown for OpenGL and X11 below: first choose the default, then answer no, finally answer yes.</p>
<p>(Again, note that none of these questions have to be answered if the libraries are all being found)</p>


<pre>  Where would you like the system installed? /usr/local/cm3 </pre>

<pre>  What should be the default text editor for new Reactor users? /usr/bin/vi</pre>

<pre>  Where are the flex/bison libraries? /usr/lib</pre>

<pre>  Where are the Postgres95 libraries? /usr/lib</pre>

<pre>  Where are the OpenGL libraries? /usr/lib</pre>
<pre>  The libraries libGL.so libGLU.so are not present in the chosen directory.</pre>
<pre>  Would you like to change the library names? no</pre>
<pre>  Would you like to continue nonetheless? yes</pre>

<pre>  Where are the ODBC libraries? /usr/lib</pre>

<pre>  Where are the Motif libraries? /usr/lib</pre>

<pre>  Where are the X11 libraries? /usr/lib</pre>
<pre>  The libraries libX11.so libICE.so libSM.so libXt.so libXext.so libXmu.so libXaw.so are not present in the chosen directory.</pre>
<pre>  Would you like to change the library names? no</pre>
<pre>  Would you like to continue nonetheless? yes</pre>

<pre>  Where is your C compiler? /usr/bin/gcc</pre>

<pre>  Where is your library archiver? /usr/bin/ar</pre>

<pre>  Where is your assembler? /usr/bin/as</pre>


<p>That's all for cminstall. You have installed the minimal cm3 compiler to /usr/local/cm3.</p>


<p>Now, we need to register cm3's path locations (not entirely unlike the instructions given by cminstall's output).</p>
<p>(The following two sudos are needed regardless of write permission to /usr/local)</p>

<p>To adjust PATH, edit the file</p>

<pre>  /etc/environment</pre>

<p>(e.g. `sudo gedit /etc/environment') and add the PATH element /usr/local/cm3/bin, to yield a line like this:</p>

<pre>  PATH="/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/games:/usr/local/cm3/bin"</pre>


<p>To adjust LD_LIBRARY_PATH, run</p>

<pre>  sudo echo /usr/local/cm3/lib > /etc/ld.so.conf.d/cm3</pre>

<p>(which creates a new single-line file in /etc/ld.so.conf.d)</p>


<p>To check whether this worked, make sure that the cm3 path elements are added to the environment variables. First, you _have_ to open a new shell to update the environment (just run `bash' or open a new terminal window). Then run</p>

<pre>  echo $LD_LIBRARY_PATH</pre>

<p>which should print something like</p>

<pre>  /usr/local/cm3/lib:/usr/local/pgsql/lib</pre>

<p>, and</p>

<pre>  echo $PATH</pre>

<p>which should print something like</p>

<pre>  /usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/games:/usr/local/cm3/bin:/usr/local/pgsql/bin</pre>

<p>. Then, try running</p>

<pre>  cm3 -version</pre>

<p>, which should print something like</p>

<pre>  Critical Mass Modula-3 version d5.5.1-2008-01-24-03-35-01</pre>
<pre>    last updated: 2007-12-30</pre>
<pre>    compiled: 2008-01-24 03:54:37</pre>
<pre>    configuration: /usr/local/cm3/bin/cm3.cfg</pre>

<p>. Great, the minimal binary installation is now complete! However, there is not much you can do with *this* cm3, yet.</p>


<p>=========================================================================</p>


<p>Let's continue with downloading and compiling the full cm3 sources.</p>

<p>Upon writing this file, the newest available stable tarballs (version 5.4.0) are too old. So, you have to go about downloading the cm3 sources from CVS like this:</p>
<p>(CVS instructions adapted from http://modula3.elegosoft.com/cm3/cvs-cm3.html )</p>

<pre>  cd   # (go to your home directory)</pre>
<pre>  cvs -d :pserver:anonymous@modula3.elegosoft.com:/usr/cvs login</pre>

<p>When prompted for a password, just hit Enter.</p>
<p>Now you can choose to take the exact state that worked when writing this file, or to use the newest available sources.</p>
<p>The sources that worked for me are obtained via:</p>

<pre>  cvs -z 3 -d :pserver:anonymous@modula3.elegosoft.com:/usr/cvs checkout -D "2008-01-24 23:52" cm3</pre>

<p>The most recent sources, as of the time that you are running the command, are obtained via:</p>

<pre>  cvs -z 3 -d :pserver:anonymous@modula3.elegosoft.com:/usr/cvs checkout cm3</pre>

<p>This will download the complete cm3 sources and may take a while.</p>
<p>(I added a `-z 3' argument to use level 3 compression for transferring the data, to speed up the download.)</p>


<p>=========================================================================</p>


<p>Now we're ready to start compiling the full-featured cm3 compiler, using the minimal cm3 compiler from above:</p>

<pre>  cd ~/cm3/scripts</pre>
<pre>  sudo -s  # skip this sudo if you have write permission to /usr/local/cm3</pre>
<pre>  ./do-cm3-core.sh buildship</pre>
<pre>  ./install-cm3-compiler.sh upgrade</pre>
<pre>  ./do-cm3-std.sh buildship</pre>

<p>These lines will compile for a long time, producing lots of output. Make sure that each of them exited without errors. If some of the libraries were missing upon cminstall (above), some packages may not compile successfully. It may help to run</p>
<pre>  ./do-cm3-std.sh buildship</pre>
<p>a few more times.</p>

<p>[TODO: how to exclude certain packages from compilation and shipping]</p>

<p>If these commands complete without issuing error messages in the last few lines, your cm3 installation was probably successful. Again, verify that your full-featured cm3 is working. Run:</p>

<pre>  cm3 -version</pre>

<p>and expect output like:</p>

<pre>  Critical Mass Modula-3 version d5.5.1</pre>
<pre>    last updated: 2007-12-30</pre>
<pre>    compiled: 2008-01-24 23:08:24</pre>
<pre>    configuration: /usr/local/cm3/bin/cm3.cfg</pre>


<p>=========================================================================</p>


<p>You can now free some disc space.</p>
<p>You will definitely want to remove the minimal binary files. You won't need them anymore:</p>

<pre>  rm -rf ~/cm3-min</pre>

<p>If you want to make changes to the cm3 compiler itself, you can keep the sources at ~/cm3 for rebuilding at a later stage. Otherwise, just remove these as well:</p>

<pre>  rm -rf ~/cm3</pre>

<p>This should leave your home directory as it was before you started the installation.</p>


<p>=========================================================================</p>


<p>Congratulations, you have just installed Critical Mass Modula3 on your Ubuntu 7.10 system!</p>
<p>Thank you for using Critical Mass Modula3 - for further questions, feel free to contact m3-support@elego.de</p>

