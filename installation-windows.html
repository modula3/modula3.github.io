<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
  <head>
    <title>CM3 Installation Notes for Windows (x86)</title>
    <META HTTP-EQUIV="Content-Type" CONTENT="text/html">
    <META HTTP-EQUIV="Content-Style-Type" CONTENT="text/css">
    <META HTTP-EQUIV="Resource-type" CONTENT="document"> 
    <META HTTP-EQUIV="Reply-to" CONTENT="m3-support@elego.de"> 
    <LINK HREF="normal.css" REL="stylesheet" TYPE="text/css">
    <META NAME="robots" content="noindex">
  </head>

  <body bgcolor="#ffffff">
    <h1>CM3 Installation Notes for Windows (x86)</h1>

<p>
Skim <a href="installation.html">installation.html</a>, ignoring
anything about cminstall.
</p>
<p>
A Microsoft Visual C++ toolset is required. All versions from 2.0 to
8.0 have recieved some amount of testing and should work. 9.0 should
work.  The 7.1 and 8.0 "express editions" work. 8.0 is the most
heavily used currently.
</p>
<p>
A compiler, linker, and C runtime headers and libs are needed, as
provided by Microsoft Visual C++.
</p>
<p>
Some Windows SDK .libs are needed. Most versions of Visual C++ come
with them, and if you build CM3 from source, they will be
built. Dependency otherwise on the Windows SDK is to be determined. It
is minimal though.
</p>
<p>
There is no support currently for any other compiler, linker, or C
runtime, though there are many potential alternatives. (Open Watcom,
Digital Mars, Metrowerks CodeWarrior, GNU (Cygwin, MinGWin)).
</p>
<p>
All 32 bit Windows client and server operating systems from Windows 95
through Server 2003 and Vista are viable and should work, if they are
supported by the Visual C++ toolset. XP is the most heavily used as of
the end of the year 2007.  Windows 95/98 have drastically reduced
support in that the current Visual C++ toolset does not run on them,
nor do the various .cmd files used to automate building CM3 work on
them. However the results of your build should work. And older Visual
C++ toolsets run on them. If anyone is interested in CM3 running on or
targeting any Windows operating system version prior to Windows XP,
send mail to m3devel.
</p>
<p>
Only x86 is currently supported.  IA64 and AMD64 Windows should be
able to run the x86 output just fine.
</p>
<p>
A redistributable C runtime update may be needed on the target system,
such as
</p>
<quote>
  <a href="http://www.microsoft.com/downloads/details.aspx?FamilyID=200b2fd9-ae1a-4a14-984d-389c36f85647"
  >http://www.microsoft.com/downloads/details.aspx?FamilyID=200b2fd9-ae1a-4a14-984d-389c36f85647</a>.
</quote>
<p>
Open a command prompt (start.run."cmd", or "command" on Windows 9x)
There is also a shortcut on the start menu to this and you may use
it.
</p>

<p>
Run vcvars32.bat or vsvars32.bat, such as:
</p>

<pre>
    C:\msdev\80>dir /s/b v*bat
    C:\msdev\80\Common7\Tools\vsvars32.bat  &lt;--
    C:\msdev\80\VC\vcvarsall.bat
    C:\msdev\80\VC\bin\vcvars32.bat
</pre>

<p>
There may also be a shortcut on your start menu to this; you may use it.
</p>

<p>
  <a name="helloc">Ensure your toolset is working (in the style of
  www.linuxfromscratch.org):</a>
</p>

<pre>
    echo main() { puts("hello"); } > hello.c
    cl -nologo hello.c
    .\hello
    ==&gt; hello
    del hello.c hello.exe hello.obj
</pre>

<p>
If you are going to rebuild CM3 from source, ensure you have a working
version of cvs. You can get this from www.cygwin.com.
</p>

<p>
For 5.5.0 or later, <a href="#d550">skip ahead</a>.
</p>

<p>
For <a href="http://modula3.elegosoft.com/cm3/cm3-min-WIN32-NT386-5.2.6.tgz">5.2.6</a> and earlier, do the folowing, making appropriate substitutions,
and recognizing what is input and what is output and what is comments.
</p>

<pre>
    mkdir C:\cm3
    cd /d C:\cm3
</pre>
<p>
Or on Windows 9x:
</p>

<pre>
    C:
    mkdir cm3
    cd \cm3
</pre>
<p>
Older versions of tar need the z flag for decompression.
</p>
<pre>
   tar xfv &ltpath&gt\cm3-min-WIN32-NT386-&ltversion&gt.tar.gz
</pre>
<p>
or
</p>
<pre>
    tar xfvz &ltpath&gt\cm3-min-WIN32-NT386-&ltversion&gt.tar.gz
</pre>
<p>
Giving you:
</p>
<pre>
    cminstall.exe
    COPYRIGHT-CMASS
    cygwin.dll
    gzip.exe
    system.tgz
    tar.exe
</pre>
<pre>
    del cminstall.exe tar.exe gzip.exe cygwin.dll
    start wordpad COPYRIGHT-CMASS

    tar xf system.tgz
</pre>
<p>
or
</p>
<pre>
    tar xfz system.tgz

    set PATH=C:\cm3\bin;%PATH%
</pre>
<p>
The .libs that come with 5.2.6 generally don't work, depending on
what Visual C++ version you are using and either your Visual C++
toolset contains replacements, or you will build replacements as
part of building CM3 from source. Delete them:
</p>
<pre>
    del /q c:\cm3\lib\*
</pre>
<p>
If you are going to build your own current compiler:
Checkout the current source from CVS. Don't fetch an older release.
</p>
<pre>
    mkdir c:\src
    cd /d c:\src
    cvs -d :pserver:anonymous@modula3.elegosoft.com:/usr/cvs login
</pre>
<p>
There is no password (simply type return). Then you can checkout
everything with
</p>
<pre>
    cvs -z4 -d :pserver:anonymous@modula3.elegosoft.com:/usr/cvs checkout cm3
</pre>
<p>
Take the checked in configuration verbatim:
</p>
<pre>
    del c:\cm3\bin\cm3.cfg
    copy c:\src\cm3\m3-sys\cminstall\src\config\NT386 c:\cm3\bin\cm3.cfg
</pre>
<p>
OR if you are just going to stick with 5.2.6, get a current
<a href="http://modula3.elegosoft.com/cgi-bin/cvsweb.cgi/cm3/m3-sys/cminstall/src/config/NT386"config file</a>;<br>
click where it says "text" next to "download";<br>
save the file c:\cm3\bin\cm3.cfg, replacing the file that came from system.tgz
</p>
<p>
  <a name="cm3runs">Make sure your cm3 compiler can run:</a>
</p>
<pre>
    cm3 -version
    ==&gt; Critical Mass Modula-3 version 5.2.6
        last updated: 2003-06-27
        configuration: cm3.cfg
</pre>
<p>
If this does not work, you probably forgot:
</p>
<pre>
    set PATH=C:\cm3\bin;%PATH%
</pre>
<p>
  <a name="hellom3">Build a test program:</a>
</p>
<pre>
    mkdir \scratch
    cd \scratch
    echo MODULE Hello EXPORTS Main; &gt; Hello.m3
    echo IMPORT IO; &gt;&gt; Hello.m3
    echo BEGIN &gt;&gt; Hello.m3
    echo  IO.Put("Hello"); &gt;&gt; Hello.m3
    echo END Hello. &gt;&gt; Hello.m3
    cm3
    NT386\prog.exe
    ==> Hello
</pre>
<p>
There can be link erors here.
For example if you forgot to delete \cm3\lib\*.
Or if you don't have a Platform SDK.
These errors will be fixed when we build our own Windows .libs.
For most people though, this should work (remember to delete \cm3\lib\*).
</p>
<p>
If you are just going to use 5.2.6, you are done.
<a name="buildm3"/>If you want to build a current system from source,
continue.
</p>
<pre>
    cd /d c:\src\cm3\scripts\win

    .\upgrade
</pre>
<p>
Upgrade does A LOT.  It starts with a sanity check of your
environment.  Some of what upgrade does will appear to be the same
thing repeated.  It might even be. That is ok.  In particular,
older compilers cannot build newer Modula-3 runtimes, so the
currently installed compiler is first used to build a current
compiler with the currently installed runtime. Then that compiler
is used to build the new system.
</p>
<p>
When upgrade finishes successfully it should clearly indicate
so, with a message such as, currently:
</p>
<pre>
    upgrade : Done.
    upgrade : You should now have a current compiler, runtime, and core
    upgrade : packages, and be able to build and/or ship "anything" up to and
    upgrade : including "standard". i.e. do-cm3-std buildship, or cd around the
    upgrade : source tree and cm3 or cm3 -ship.
</pre>
<p>
If you run cm3 -version now, you should get something more recent, such as:
</p>
<pre>
    Critical Mass Modula-3 version d5.5.0
        last updated: 2006-10-30
        configuration: C:\cm3\bin\cm3.cfg
</pre>
<p>
and your C:\cm3 directory should have many more files than previously, if you
started with a "min" archive.
</p>
<p>
If you are satisfied with your current state, you can delete the package
backup that upgrade made in C:\cm3\pkg-*.
</p>
<p>
<a href="#buildm3current">Now that your system is current</a>, you can
    rebuild it more easily/quickly.</a>
</p>
<p>
<a name="d550">For 5.5.0 or later.</a>
In this case, the archive is a bit more ready to go from the start.
cminstall is deleted, the cm3.cfg file is ready to go, and the compiler
is more up to date so there is less motivation to rebuild it from source.
(To be fair, 5.2.6 works fine, it is just not to MY taste.)
</p>
<pre>
    tar tf &lt;path&gt;\cm3-min-WIN32-NT386-&lt;version&gt;.tar.bz2 | more
</pre>
<p>
to get a quick feel of the structure -- does it have a version
specific prefix or not.
</p>
<p>
Presently I see:
</p>
<pre>
    cm3/
    cm3/bin/
    cm3/bin/cm3.cfg
    cm3/bin/cm3.exe
    cm3/bin/m3.dll
    cm3/bin/m3core.dll
    cm3/bin/mklib.exe
    cm3/COPYRIGHT-CMASS
    cm3/lib/
    cm3/lib/advapi32.lib
    cm3/lib/comctl32.lib
    cm3/lib/comdlg32.lib
</pre>
<p>
  So a good install process is;
</p>
<pre>
    cd /d c:\

    rmdir /q/s cm3

    tar xf &lt;path&gt;\cm3-min-WIN32-NT386-&lt;version&gt;.tar.bz2

    set PATH=C:\cm3\bin;%PATH%
</pre>
<p>
  And you are all set.
</p>
<p>
\cm3\lib\* in this toolset should be compatible with all Visual C++ toolsets
as they were built with 2.0 but with a current list of exports.
However, if in doubt, you may delete these files.
</p>
<p>
You may now optionally continue on to:<br>
  <a href="#hellom3">build a test program</a><br>
  <a href="#buildm3">rebuild cm3 from source</a><br>
</p>
<p>
<a name="buildm3current"/>
However there are simpler faster ways to rebuild cm3 from source since
you are starting with a newer compiler/runtime. Upgrade.cmd is deoptimized
in order to support building a new compiler from an old compiler/runtime.
</p>
<p>
You can do something like:
</p>
<pre>
    cd /d c:\src\cm3\scripts\win

    rem p for packages
    set p=import-libs m3core libm3 m3middle m3objfile m3linker m3back m3staloneback m3front m3quake cm3 patternmatching mklib
    do-pkg buildship %p%
</pre>
<p>
The compiler is "special" in that it can't "ship" (copy to the live
location) itself, so:
</p>
<pre>
    install-cm3-compiler upgrade (see also install-cm3-compiler help)
</pre>
<p>
To rebuild clean:
</p>
<pre>
    do-pkg realclean %p%
    do-pkg buildship %p%
</pre>
<p>
  See also the various do-*.cmd files.
  If you haven't programmed in CMD before, they might take some
  getting used to. They are just wrappers around do-pkg with
  predefined lists of packages -- "core", "std", "min".
</p>
<p>
  do-pkg is a wrapper around cd'ing to the directory that package is
  in and running cm3 with the specifiied command.
</p>

    <hr>
    <address><a href="mailto:m3-support{at}elego.de">m3-support{at}elego.de</a></address>
<!-- Created: Fri Feb 16 15:27:10 MET 2001 -->
  </body>
</html>
